[
    {
        "essential" : true,
        "memory" : ${memory},
        "name" : "${name}",
        "cpu" : ${cpu},
        "image" : "${image}",
        "taskRoleArn" : "${default_container_task_role}",
        "dockerLabels": ${dockerLabels},
        "environment": ${environment},
        "secrets" : [
        {
            "name" : "DB_HOST",
            "valueFrom" : "${secret}"
        }
        ],
        "portMappings" : [
        {
            "containerPort" : ${container_port},
            "hostPort" : ${container_port}
        }
        ],
        "logConfiguration" : {
        "logDriver" : "awslogs",
        "options" : {
            "awslogs-group" : "${log_group}",
            "awslogs-region" : "${region}",
            "awslogs-stream-prefix" : "${awslogs-stream-prefix}"
        }
        }
    %{ if create_datadog }
    },
    {
        "logConfiguration" : {
            "logDriver" : "awslogs",
            "options" : {
                "awslogs-group" : "${log_group}",
                "awslogs-region" : "${region}",
                "awslogs-stream-prefix" : "${awslogs-stream-prefix}"
            }
        },
        "name": "${dd_name}",
        "image": "${dd_image}",
        "memoryReservation": ${dd_memory},
        "cpu": ${dd_cpu},
        "environment" : ${dd_environment},
        "portMappings" : [
            {
            "hostPort" : ${dd_container_port},
            "protocol" : "tcp",
            "containerPort" : ${dd_container_port}
            }
        ],
        "secrets" : [
        {
            "name" : "DD_API_KEY",
            "valueFrom" : "${dd_api_key}"
        }
            ]
    }
    %{ else }
    }
    %{ endif }

]